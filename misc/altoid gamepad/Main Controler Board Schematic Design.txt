# Altoids Gamepad - Main Controller Schematic
# KiCad Schematic File (.sch)

# TITLE: Altoids Retro Gamepad - Main Controller
# REVISION: 1.0
# DATE: 2025-06-18
# DESIGNED BY: Assistant
# COMPANY: DIY Project

# Component Placement and Connections:

## RASPBERRY PI ZERO 2W CONNECTION
# Pi Zero GPIO Header (J1) - 40-pin
# Pin assignments for our project:
# GPIO 2  (Pin 3)  - I2C SDA (MCP23017)
# GPIO 3  (Pin 5)  - I2C SCL (MCP23017)  
# GPIO 18 (Pin 12) - I2S BCLK (Audio)
# GPIO 19 (Pin 35) - I2S LRCLK (Audio)
# GPIO 21 (Pin 40) - I2S DIN (Audio)
# GPIO 8  (Pin 24) - SPI CE0 (Display)
# GPIO 10 (Pin 19) - SPI MOSI (Display)
# GPIO 9  (Pin 21) - SPI MISO (Display)
# GPIO 11 (Pin 23) - SPI SCLK (Display)
# GPIO 25 (Pin 22) - Display DC
# GPIO 24 (Pin 18) - Display Reset
# GPIO 22 (Pin 15) - Touch CS
# GPIO 27 (Pin 13) - Touch IRQ
# 5V      (Pin 2,4) - Power Rail
# 3V3     (Pin 1,17) - 3.3V Rail
# GND     (Pins 6,9,14,20,25,30,34,39) - Ground

## POWER MANAGEMENT SECTION
# PowerBoost 1000C (U2)
# Connections:
# BAT+ -> Battery JST Positive
# BAT- -> Battery JST Negative  
# USB+ -> USB-C VBUS
# USB- -> USB-C GND
# EN   -> Power Switch
# 5V   -> Pi 5V Rail
# GND  -> Ground Plane

# Power Switch (SW1) - SPDT
# Common -> PowerBoost EN
# NO     -> 3V3 (Enable)
# NC     -> GND (Disable)

# USB-C Connector (J2)
# VBUS -> PowerBoost USB+
# GND  -> Ground Plane
# D+/D- -> Not Connected (Power only)

# Battery JST Connector (J3)
# + -> PowerBoost BAT+
# - -> Ground Plane

## INPUT CONTROL SECTION
# MCP23017 I/O Expander (U1)
# I2C Address: 0x20 (A0,A1,A2 = GND)
# Connections:
# VDD -> 3V3
# VSS -> GND
# SCL -> Pi GPIO 3 (I2C SCL)
# SDA -> Pi GPIO 2 (I2C SDA)
# A0,A1,A2 -> GND (Address 0x20)
# RESET -> 3V3 (via 10K pullup R1)
# INTA,INTB -> Not Connected

# Button Matrix (8 buttons total):
# GPA0 -> D-Pad Up    (SW2)
# GPA1 -> D-Pad Down  (SW3)  
# GPA2 -> D-Pad Left  (SW4)
# GPA3 -> D-Pad Right (SW5)
# GPA4 -> A Button    (SW6)
# GPA5 -> B Button    (SW7)
# GPA6 -> Start Button (SW8)
# GPA7 -> Select Button (SW9)

# All buttons connect:
# One side -> MCP23017 GPIO pin
# Other side -> GND
# Internal pullups enabled in software

## AUDIO SECTION  
# MAX98357A I2S Amplifier (U3)
# Connections:
# VIN -> 5V Rail
# GND -> Ground Plane
# BCLK -> Pi GPIO 18 (I2S BCLK)
# LRCLK -> Pi GPIO 19 (I2S LRCLK) 
# DIN -> Pi GPIO 21 (I2S DIN)
# GAIN -> GND (9dB gain)
# SD -> 3V3 (Enable)
# OUT+ -> Speaker+ 
# OUT- -> Speaker-

# Speaker (SP1) - 8 Ohm, 2W
# + -> MAX98357A OUT+
# - -> MAX98357A OUT-

# 3.5mm Audio Jack (J4) - Optional
# Tip -> Audio Left
# Ring -> Audio Right  
# Sleeve -> GND
# Switch -> Disconnect speaker when inserted

## DISPLAY INTERFACE SECTION
# 2.8" TFT Display connection via ribbon cable
# Display PCB will handle the actual TFT connections
# Main board provides:
# 5V, 3V3, GND power
# SPI signals (MOSI, MISO, SCLK, CE0)
# Control signals (DC, Reset)
# Touch interface (Touch CS, Touch IRQ)

# Display Connector (J5) - 10-pin ribbon
# Pin 1  -> 5V
# Pin 2  -> 3V3  
# Pin 3  -> GND
# Pin 4  -> SPI MOSI (GPIO 10)
# Pin 5  -> SPI MISO (GPIO 9)
# Pin 6  -> SPI SCLK (GPIO 11)
# Pin 7  -> SPI CE0 (GPIO 8)
# Pin 8  -> Display DC (GPIO 25)
# Pin 9  -> Display Reset (GPIO 24)
# Pin 10 -> Touch CS (GPIO 22)

## POWER DISTRIBUTION
# 5V Rail: PowerBoost output -> Pi, Display, Audio Amp
# 3V3 Rail: Pi 3V3 output -> MCP23017, pullups, logic
# GND: Common ground plane

## PASSIVE COMPONENTS
# R1: 10K ohm - MCP23017 Reset pullup
# R2: 10K ohm - I2C SDA pullup  
# R3: 10K ohm - I2C SCL pullup
# C1: 100uF electrolytic - 5V power filtering
# C2: 10uF ceramic - 3V3 power filtering
# C3: 100nF ceramic - MCP23017 decoupling
# C4: 100nF ceramic - Audio amp decoupling

## PCB SPECIFICATIONS
# Board Size: 90mm x 55mm (fits Altoids tin)
# Layer Count: 2 (Top + Bottom)
# Thickness: 1.6mm standard
# Via Size: 0.2mm drill, 0.45mm annular ring
# Trace Width: 0.2mm minimum, 0.5mm for power
# Ground Plane: Bottom layer pour
# Power Plane: Top layer traces with thick routing

# COMPONENT PLACEMENT NOTES:
# - Pi Zero mounts in center-left
# - PowerBoost near battery connector  
# - MCP23017 near button area
# - Audio amp on edge near speaker
# - All connectors on board edges
# - Test points for debugging

# ROUTING PRIORITIES:
# 1. Power distribution (5V, 3V3, GND)
# 2. I2C bus (short, equal length)
# 3. SPI display interface
# 4. I2S audio signals
# 5. Button inputs (can be longer)

# This schematic defines the electrical connections
# PCB layout will optimize for mechanical constraints
# Component values chosen for reliable operation